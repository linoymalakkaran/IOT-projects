<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">
  <!-- Background -->
  <rect width="900" height="700" fill="#f5f5f5" />
  
  <!-- Title -->
  <text x="450" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle">WAT Water Treatment - Azure IoT Solution Architecture</text>
  
  <!-- Device Layer -->
  <rect x="50" y="70" width="800" height="100" fill="#d1ecf1" stroke="#17a2b8" stroke-width="1" rx="5" />
  <rect x="50" y="70" width="120" height="30" fill="#d1ecf1" stroke="#17a2b8" stroke-width="1" rx="5" />
  <text x="110" y="90" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">Device Layer</text>
  
  <!-- Device Layer Components -->
  <rect x="70" y="110" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="150" y="135" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">IoT Water Meters</text>
  
  <rect x="250" y="110" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="330" y="135" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">LoRaWAN Gateways</text>
  
  <rect x="430" y="110" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="510" y="135" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Azure IoT Edge</text>
  
  <rect x="610" y="110" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="690" y="135" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Cellular Backup</text>
  
  <!-- Connectivity Layer -->
  <rect x="50" y="180" width="800" height="100" fill="#d4edda" stroke="#28a745" stroke-width="1" rx="5" />
  <rect x="50" y="180" width="120" height="30" fill="#d4edda" stroke="#28a745" stroke-width="1" rx="5" />
  <text x="110" y="200" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">Connectivity Layer</text>
  
  <!-- Connectivity Layer Components -->
  <rect x="70" y="220" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="150" y="245" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">LoRaWAN Network</text>
  
  <rect x="250" y="220" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="330" y="245" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Azure IoT Hub</text>
  
  <rect x="430" y="220" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="510" y="245" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Device Provisioning</text>
  
  <rect x="610" y="220" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="690" y="245" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Azure Event Grid</text>
  
  <!-- Cloud Ingestion & Processing Layer -->
  <rect x="50" y="290" width="800" height="100" fill="#fff3cd" stroke="#ffc107" stroke-width="1" rx="5" />
  <rect x="50" y="290" width="200" height="30" fill="#fff3cd" stroke="#ffc107" stroke-width="1" rx="5" />
  <text x="150" y="310" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">Cloud Ingestion &amp; Processing Layer</text>
  
  <!-- Cloud Layer Components -->
  <rect x="70" y="330" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="150" y="355" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Event Hubs</text>
  
  <rect x="250" y="330" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="330" y="355" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Stream Analytics</text>
  
  <rect x="430" y="330" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="510" y="355" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Azure Functions</text>
  
  <rect x="610" y="330" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="690" y="355" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Azure Databricks</text>
  
  <!-- Storage Layer -->
  <rect x="50" y="400" width="800" height="100" fill="#d1ecf1" stroke="#17a2b8" stroke-width="1" rx="5" />
  <rect x="50" y="400" width="120" height="30" fill="#d1ecf1" stroke="#17a2b8" stroke-width="1" rx="5" />
  <text x="110" y="420" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">Storage Layer</text>
  
  <!-- Storage Layer Components -->
  <rect x="70" y="440" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="150" y="465" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Cosmos DB</text>
  <text x="150" y="480" font-family="Arial, sans-serif" font-size="10" text-anchor="middle">(Hot Data)</text>
  
  <rect x="250" y="440" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="330" y="465" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Time Series</text>
  <text x="330" y="480" font-family="Arial, sans-serif" font-size="10" text-anchor="middle">(Warm Data)</text>
  
  <rect x="430" y="440" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="510" y="465" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Data Lake</text>
  <text x="510" y="480" font-family="Arial, sans-serif" font-size="10" text-anchor="middle">(Cold Data)</text>
  
  <rect x="610" y="440" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="690" y="465" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Blob Storage</text>
  <text x="690" y="480" font-family="Arial, sans-serif" font-size="10" text-anchor="middle">(Archive)</text>
  
  <!-- Application & Integration Layer -->
  <rect x="50" y="510" width="800" height="100" fill="#e2d9f3" stroke="#6f42c1" stroke-width="1" rx="5" />
  <rect x="50" y="510" width="220" height="30" fill="#e2d9f3" stroke="#6f42c1" stroke-width="1" rx="5" />
  <text x="160" y="530" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">Application &amp; Integration Layer</text>
  
  <!-- App Layer Components -->
  <rect x="70" y="550" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="150" y="575" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Digital Twins</text>
  
  <rect x="250" y="550" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="330" y="575" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">App Service</text>
  <text x="330" y="590" font-family="Arial, sans-serif" font-size="10" text-anchor="middle">(WebAPI)</text>
  
  <rect x="430" y="550" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="510" y="575" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Power BI</text>
  <text x="510" y="590" font-family="Arial, sans-serif" font-size="10" text-anchor="middle">(Dashboards)</text>
  
  <rect x="610" y="550" width="160" height="40" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="690" y="575" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle">Logic Apps</text>
  <text x="690" y="590" font-family="Arial, sans-serif" font-size="10" text-anchor="middle">(SCADA Integration)</text>
  
  <!-- Security & Governance Layer (Vertical) -->
  <rect x="860" y="70" width="30" height="540" fill="#f8d7da" stroke="#dc3545" stroke-width="1" rx="5" />
  <text x="875" y="340" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" transform="rotate(90, 875, 340)">Security &amp; Governance</text>
  
  <!-- Monitoring & Management Layer (Vertical) -->
  <rect x="10" y="70" width="30" height="540" fill="#f8d7da" stroke="#dc3545" stroke-width="1" rx="5" />
  <text x="25" y="340" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" transform="rotate(270, 25, 340)">Monitoring &amp; Management</text>
  
  <!-- Connections -->
  <!-- Device to Connectivity -->
  <line x1="150" y1="150" x2="150" y2="220" stroke="#000" stroke-width="1.5" />
  <line x1="330" y1="150" x2="330" y2="220" stroke="#000" stroke-width="1.5" />
  <line x1="510" y1="150" x2="510" y2="220" stroke="#000" stroke-width="1.5" />
  <line x1="690" y1="150" x2="690" y2="220" stroke="#000" stroke-width="1.5" />
  
  <!-- Connectivity to Cloud -->
  <line x1="150" y1="260" x2="150" y2="330" stroke="#000" stroke-width="1.5" />
  <line x1="330" y1="260" x2="330" y2="330" stroke="#000" stroke-width="1.5" />
  <line x1="510" y1="260" x2="510" y2="330" stroke="#000" stroke-width="1.5" />
  <line x1="690" y1="260" x2="690" y2="330" stroke="#000" stroke-width="1.5" />
  
  <!-- Cloud to Storage -->
  <line x1="150" y1="370" x2="150" y2="440" stroke="#000" stroke-width="1.5" />
  <line x1="330" y1="370" x2="330" y2="440" stroke="#000" stroke-width="1.5" />
  <line x1="510" y1="370" x2="510" y2="440" stroke="#000" stroke-width="1.5" />
  <line x1="690" y1="370" x2="690" y2="440" stroke="#000" stroke-width="1.5" />
  
  <!-- Storage to Application -->
  <line x1="150" y1="480" x2="150" y2="550" stroke="#000" stroke-width="1.5" />
  <line x1="330" y1="480" x2="330" y2="550" stroke="#000" stroke-width="1.5" />
  <line x1="510" y1="480" x2="510" y2="550" stroke="#000" stroke-width="1.5" />
  <line x1="690" y1="480" x2="690" y2="550" stroke="#000" stroke-width="1.5" />
  
  <!-- Event Trigger Flows (Dotted) -->
  <line x1="230" y1="340" x2="250" y2="340" stroke="#000" stroke-width="1" stroke-dasharray="5,3" />
  <line x1="410" y1="340" x2="430" y2="340" stroke="#000" stroke-width="1" stroke-dasharray="5,3" />
  <line x1="590" y1="340" x2="610" y2="340" stroke="#000" stroke-width="1" stroke-dasharray="5,3" />
  
  <!-- Notes at Bottom -->
  <rect x="100" y="625" width="700" height="60" fill="none" stroke="none" rx="5" />
  <text x="100" y="640" font-family="Arial, sans-serif" font-size="11" text-anchor="start">• Multi-Region Deployment with Active-Active Configuration for 99.9% Availability</text>
  <text x="100" y="660" font-family="Arial, sans-serif" font-size="11" text-anchor="start">• Automatic Failover and Load Balancing across Regions</text>
  <text x="100" y="680" font-family="Arial, sans-serif" font-size="11" text-anchor="start">• Edge Processing for Local Control During Cloud Connectivity Loss</text>
  
  <!-- Legend -->
  <rect x="650" y="625" width="15" height="15" fill="none" stroke="#000" stroke-width="1.5" />
  <text x="675" y="638" font-family="Arial, sans-serif" font-size="11" text-anchor="start">Normal Flow</text>
  
  <rect x="650" y="645" width="15" height="15" fill="none" stroke="#000" stroke-width="1" stroke-dasharray="5,3" />
  <text x="675" y="658" font-family="Arial, sans-serif" font-size="11" text-anchor="start">Event Trigger</text>
</svg>